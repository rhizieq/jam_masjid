<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <!-- TIZEN OPTIMIZATION: Kunci layar agar tidak bisa di-zoom/geser -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jam Masjid Nurul Ilmi ITPLN - Final Fix</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600;800&family=Oswald:wght@200;400;500;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- GLOBAL STYLES --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            background-image: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 100%);
            overflow: hidden; 
            cursor: none; /* Hilangkan kursor mouse */
            user-select: none;
            color: #1e293b;
        }

        /* Glass Sidebar */
        .glass-sidebar {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-right: 1px solid white;
            box-shadow: 10px 0 30px rgba(0,0,0,0.05);
        }

        .font-clock { font-family: 'Oswald', sans-serif; }
        .font-arab { font-family: 'Amiri', serif; }

        /* Animations */
        @keyframes blink { 50% { opacity: 0; } }
        .blink { animation: blink 1s infinite; }

        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; }
        .marquee-text { display: inline-block; padding-left: 100%; animation: marquee 40s linear infinite; }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        .slide-image { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 1.5s; }
        .slide-image.active { opacity: 1; }

        /* Prayer Item */
        .prayer-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 20px; margin-bottom: 8px; border-radius: 10px;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(203, 213, 225, 0.5);
            transition: all 0.3s;
        }
        .prayer-item.active {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            border-color: #059669; transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.2);
        }
        .prayer-item.active * { color: white !important; }

        /* Overlay */
        #overlay-screen { display: none; position: fixed; inset: 0; z-index: 9999; background: #020617; color: white; flex-direction: column; align-items: center; justify-content: center; }
        .overlay-active { display: flex !important; }
        .progress-bar { width: 0%; height: 8px; background: #34d399; border-radius: 4px; transition: width 1s linear; }
    </style>
</head>
<body class="flex w-screen h-screen">

    <!-- OVERLAY (Adzan/Iqomah) -->
    <div id="overlay-screen">
        <div class="absolute top-0 w-full h-2 bg-gradient-to-r from-emerald-500 via-yellow-400 to-emerald-500"></div>
        
        <!-- Logo on Overlay (White Version via Filter) -->
        <img id="logo-overlay" src="gambar/LOGO_IT_PLN_Kotak.png" 
             class="w-32 h-auto mb-6 opacity-90 filter brightness-0 invert" 
             onerror="this.style.display='none'">
        
        <div id="overlay-status" class="text-3xl font-light tracking-[0.4em] text-emerald-400 mb-2 uppercase animate-pulse">MEMASUKI WAKTU</div>
        <h1 id="overlay-title" class="text-[9rem] font-bold font-clock mb-4 leading-none tracking-tighter">ADZAN</h1>
        <div id="overlay-subtitle" class="text-4xl text-gray-400 mb-10 font-arab">Hayya 'alas Shalah</div>
        
        <div id="iqomah-counter-container" class="hidden w-full max-w-3xl flex-col items-center">
             <div class="w-full bg-gray-800 h-3 rounded-full mb-8 overflow-hidden border border-gray-700">
                 <div id="iqomah-progress" class="progress-bar"></div>
             </div>
             <div id="iqomah-timer" class="text-[11rem] leading-none font-clock font-bold text-yellow-400">10:00</div>
             <div class="mt-4 text-2xl text-gray-400 tracking-[0.2em] uppercase font-semibold">Menuju Iqomah</div>
        </div>
        <div id="overlay-message" class="hidden text-5xl font-bold mt-8 animate-bounce uppercase tracking-wide text-center px-4">Luruskan dan Rapatkan Shaf</div>
    </div>

    <!-- SIDEBAR (32%) -->
    <aside class="w-[32%] h-full glass-sidebar flex flex-col relative z-20">
        <div class="p-6 pb-4 flex flex-col items-center border-b border-slate-200">
            <!-- LOGO FIXED: Menggunakan URL stabil + Fallback Icon -->
            <div class="h-24 w-full flex items-center justify-center mb-3">
                <img src="https://kemahasiswaan.itpln.ac.id/assets/img/logo/logo-itpln.png" 
                     alt="Logo ITPLN" 
                     class="h-full w-auto object-contain drop-shadow-md"
                     onerror="this.style.display='none'; document.getElementById('fallback-icon').style.display='block';">
                <!-- Fallback jika gambar rusak -->
                <i id="fallback-icon" class="fas fa-mosque text-6xl text-emerald-600 hidden"></i>
            </div>
            
            <h1 class="text-2xl font-bold text-center text-slate-800 tracking-tight uppercase leading-none">Masjid Nurul Ilmi</h1>
            <div class="mt-2 text-xs font-bold text-slate-500 tracking-widest uppercase">Institut Teknologi PLN</div>
        </div>

        <div class="p-4 flex flex-col items-center justify-center bg-slate-50/50">
            <div class="text-7xl font-clock font-bold text-slate-800 leading-none flex items-baseline">
                <span id="clock-hours">00</span><span class="blink text-emerald-600 mx-1">:</span><span id="clock-minutes">00</span>
            </div>
            <div class="text-xl text-slate-500 font-medium mt-1" id="clock-seconds">00</div>
            <div class="mt-3 text-center w-full border-t border-slate-200 pt-3">
                <div id="date-masehi" class="text-lg font-bold text-slate-700">Loading...</div>
                <div id="date-hijri" class="text-xl text-emerald-600 font-arab font-semibold mt-1">Loading...</div>
            </div>
        </div>

        <div class="flex-grow px-4 py-2 overflow-y-auto" id="prayer-list-container">
            <div class="text-center text-slate-400 animate-pulse mt-4">Sinkronisasi Jadwal...</div>
        </div>
        
        <div class="p-3 text-center text-[10px] text-slate-400 font-medium uppercase border-t border-slate-200">
            <i class="fas fa-sync-alt mr-1"></i> Jadwal: Kemenag RI (Auto Correction)
        </div>
    </aside>

    <!-- MAIN (68%) -->
    <main class="w-[68%] h-full relative z-10 bg-slate-200">
        <div id="slider-container" class="absolute inset-0 w-full h-full overflow-hidden bg-slate-300"></div>
        
        <!-- Running Text -->
        <div class="absolute bottom-6 left-6 right-6 h-20 z-30 flex items-center bg-white/95 backdrop-blur-xl rounded-xl shadow-2xl border border-white">
            <div class="w-20 h-full bg-emerald-600 flex items-center justify-center rounded-l-xl">
                <i class="fas fa-bullhorn text-white text-2xl animate-pulse"></i>
            </div>
            <div class="flex-grow overflow-hidden relative h-full flex items-center pl-4">
                <div class="marquee-container w-full">
                    <div class="marquee-text text-2xl font-medium text-slate-800 tracking-wide">
                        Selamat Datang di Masjid Nurul Ilmi Institut Teknologi PLN. Mohon luruskan dan rapatkan shaf. Nonaktifkan HP selama ibadah. Jagalah kebersihan area masjid.
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ==========================================
        // 1. PENGATURAN & KONFIGURASI
        // ==========================================
        
        // --- Setting Durasi (Sesuai Permintaan) ---
        const CONFIG = {
            adzanTime: 1,      // 1 MENIT tampilan "ADZAN"
            iqomahTime: 10,    // 10 MENIT Hitung Mundur Iqomah
            jumatTime: 25,     // 25 MENIT Hitung Mundur Khutbah Jumat
            slideInterval: 10000 // Ganti gambar slide tiap 10 detik
        };

        // --- Setting Koreksi Waktu (Dalam Menit) ---
        // Ganti angka 2 dengan angka lain jika masih kurang pas
        const CORRECTION = {
            'Subuh': 2,   
            'Terbit': 2,
            'Dzuhur': 2,
            'Ashar': 2,
            'Maghrib': 2,
            'Isya': 2
        };

        // Koordinat ITPLN (Cengkareng)
        const COORDINATES = { lat: '-6.1764', lng: '106.7236' }; 

        const SLIDE_IMAGES = [
            "https://storage.googleapis.com/danacita-website-v3-prd/website_v3/images/Gedung_IT_PLN.original.jpg",
            "https://images.unsplash.com/photo-1564121211835-e88c852648ab?q=80&w=2070",
            "https://images.unsplash.com/photo-1542816417-0983c9c9ad53?q=80&w=2070"
        ];
        
        // ==========================================
        // 2. LOGIKA SYSTEM
        // ==========================================
        const PRAYER_NAMES = ['Subuh', 'Terbit', 'Dzuhur', 'Ashar', 'Maghrib', 'Isya'];
        let prayerTimes = {};
        let isOverlayActive = false;
        let countdownInterval = null;
        let currentSlideIndex = 0;

        // Tizen Back Button Support
        document.addEventListener('keydown', function(e) {
            if(e.keyCode === 10009) { try { tizen.application.getCurrentApplication().exit(); } catch (err) { window.history.back(); } }
        });

        // Slideshow Engine
        function initSlider() {
            const container = document.getElementById('slider-container');
            container.innerHTML = ''; 
            SLIDE_IMAGES.forEach((url, index) => {
                const img = document.createElement('img');
                img.src = url; img.className = `slide-image ${index === 0 ? 'active' : ''}`;
                container.appendChild(img);
            });
            setInterval(() => {
                const images = document.querySelectorAll('.slide-image');
                if(!images.length) return;
                images[currentSlideIndex].classList.remove('active');
                currentSlideIndex = (currentSlideIndex + 1) % images.length;
                images[currentSlideIndex].classList.add('active');
            }, CONFIG.slideInterval);
        }

        // Clock Engine
        function updateClock() {
            const now = new Date();
            document.getElementById('clock-hours').innerText = String(now.getHours()).padStart(2, '0');
            document.getElementById('clock-minutes').innerText = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('clock-seconds').innerText = String(now.getSeconds()).padStart(2, '0');

            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('date-masehi').innerText = now.toLocaleDateString('id-ID', options);

            highlightActivePrayer(now.getHours(), now.getMinutes());
            
            // Cek Trigger Waktu Adzan
            if (!isOverlayActive && Object.keys(prayerTimes).length > 0) {
                checkPrayerTrigger(now.getHours(), now.getMinutes(), now.getSeconds(), now.getDay());
            }
        }

        function getHijriDate() {
            const now = new Date();
            const formatter = new Intl.DateTimeFormat('id-ID-u-ca-islamic', { day: 'numeric', month: 'long', year: 'numeric' });
            document.getElementById('date-hijri').innerText = formatter.format(now) + " H";
        }

        // Fetch & Correct Prayer Times
        async function fetchPrayerTimes() {
            try {
                const d = new Date();
                const apiUrl = `https://api.aladhan.com/v1/timings/${d.getDate()}-${d.getMonth()+1}-${d.getFullYear()}?latitude=${COORDINATES.lat}&longitude=${COORDINATES.lng}&method=20`;
                const res = await fetch(apiUrl);
                const data = await res.json();
                const t = data.data.timings;

                prayerTimes = {
                    'Subuh': applyCorrection(t.Fajr, CORRECTION.Subuh),
                    'Terbit': applyCorrection(t.Sunrise, CORRECTION.Terbit),
                    'Dzuhur': applyCorrection(t.Dhuhr, CORRECTION.Dzuhur),
                    'Ashar': applyCorrection(t.Asr, CORRECTION.Ashar),
                    'Maghrib': applyCorrection(t.Maghrib, CORRECTION.Maghrib),
                    'Isya': applyCorrection(t.Isha, CORRECTION.Isya)
                };
                renderPrayerList();
            } catch (e) {
                console.error("Fetch Error, using fallback");
                prayerTimes = { 'Subuh': '04:10', 'Terbit': '05:30', 'Dzuhur': '11:55', 'Ashar': '15:20', 'Maghrib': '18:05', 'Isya': '19:20' };
                renderPrayerList();
            }
        }

        function applyCorrection(timeStr, addMinutes) {
            if(!timeStr) return "00:00";
            const cleanTime = timeStr.split(" ")[0]; 
            const [h, m] = cleanTime.split(':').map(Number);
            const date = new Date();
            date.setHours(h);
            date.setMinutes(m + addMinutes);
            return String(date.getHours()).padStart(2, '0') + ':' + String(date.getMinutes()).padStart(2, '0');
        }

        // Render Sidebar
        function renderPrayerList() {
            const container = document.getElementById('prayer-list-container');
            container.innerHTML = '';
            PRAYER_NAMES.forEach(name => {
                const time = prayerTimes[name];
                let icon = 'fa-moon';
                if(name === 'Terbit' || name === 'Dzuhur' || name === 'Ashar') icon = 'fa-sun';
                
                const item = document.createElement('div');
                item.id = `row-${name}`;
                item.className = 'prayer-item group';
                item.innerHTML = `
                    <div class="flex items-center gap-3">
                        <i class="fas ${icon} text-slate-400 group-hover:text-emerald-500 transition-colors w-6 text-center text-lg"></i>
                        <span class="text-sm font-semibold text-slate-500 uppercase tracking-wide group-hover:text-emerald-600">${name}</span>
                    </div>
                    <span class="text-2xl font-clock font-bold text-slate-700 tracking-wide group-hover:text-slate-900">${time}</span>
                `;
                container.appendChild(item);
            });
        }

        function highlightActivePrayer(h, m) {
            if (Object.keys(prayerTimes).length === 0) return;
            const curVal = parseInt(h) * 60 + parseInt(m);
            let found = false;
            document.querySelectorAll('.prayer-item').forEach(el => el.classList.remove('active'));

            for (let name of PRAYER_NAMES) {
                if (name === 'Terbit') continue;
                const [ph, pm] = prayerTimes[name].split(':').map(Number);
                const pVal = ph * 60 + pm;
                if (pVal > curVal && !found) {
                    found = true; document.getElementById(`row-${name}`)?.classList.add('active');
                }
            }
            if (!found) document.getElementById(`row-Subuh`)?.classList.add('active');
        }

        // --- OVERLAY LOGIC (UPDATED DURATIONS) ---
        function checkPrayerTrigger(h, m, s, day) {
            PRAYER_NAMES.forEach(name => {
                if(name === 'Terbit') return;
                const time = prayerTimes[name];
                // Trigger tepat pada detik 00
                if(time === `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}` && s === 0) {
                    startAdzan(name, day);
                }
            });
        }

        function startAdzan(name, day) {
            isOverlayActive = true;
            const overlay = document.getElementById('overlay-screen');
            overlay.classList.add('overlay-active');
            
            // Fase 1: Adzan
            document.getElementById('overlay-status').innerText = "MEMASUKI WAKTU";
            document.getElementById('overlay-title').innerText = `ADZAN ${name.toUpperCase()}`;
            document.getElementById('overlay-title').style.display = 'block';
            document.getElementById('overlay-subtitle').style.display = 'block';
            document.getElementById('iqomah-counter-container').classList.remove('flex');
            document.getElementById('iqomah-counter-container').classList.add('hidden');
            document.getElementById('overlay-message').classList.add('hidden');

            // Tunggu sesuai adzanTime (1 Menit) lalu masuk Iqomah
            setTimeout(() => startIqomah(name, day), CONFIG.adzanTime * 60 * 1000);
        }

        function startIqomah(name, day) {
            // Cek apakah ini Jumat & Dzuhur
            const isJumat = (day === 5 && name === 'Dzuhur');
            const duration = isJumat ? CONFIG.jumatTime : CONFIG.iqomahTime;
            
            // Fase 2: Iqomah / Khutbah
            document.getElementById('overlay-status').innerText = isJumat ? "KHUTBAH JUMAT" : "MENUNGGU IQOMAH";
            document.getElementById('overlay-title').style.display = 'none';
            document.getElementById('overlay-subtitle').style.display = 'none';

            const container = document.getElementById('iqomah-counter-container');
            container.classList.remove('hidden'); container.classList.add('flex');

            let timeLeft = duration * 60;
            const totalTime = timeLeft;
            
            if(countdownInterval) clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60).toString().padStart(2, '0');
                const s = (timeLeft % 60).toString().padStart(2, '0');
                document.getElementById('iqomah-timer').innerText = `${m}:${s}`;
                document.getElementById('iqomah-progress').style.width = `${((totalTime - timeLeft) / totalTime) * 100}%`;

                if (timeLeft <= 0) {
                    clearInterval(countdownInterval); showShalatAlert();
                }
            }, 1000);
        }

        function showShalatAlert() {
            // Fase 3: Shalat Dimulai
            document.getElementById('iqomah-counter-container').classList.remove('flex');
            document.getElementById('iqomah-counter-container').classList.add('hidden');
            document.getElementById('overlay-status').innerText = "SHALAT BERJAMAAH";
            document.getElementById('overlay-message').classList.remove('hidden');
            
            // Layar mati otomatis setelah 1 menit pesan shalat
            setTimeout(() => { 
                isOverlayActive = false; 
                document.getElementById('overlay-screen').classList.remove('overlay-active'); 
            }, 60 * 1000);
        }

        window.onload = () => {
            initSlider(); getHijriDate(); fetchPrayerTimes();
            setInterval(updateClock, 1000); updateClock();
            setInterval(fetchPrayerTimes, 6 * 60 * 60 * 1000);
        };
    </script>
</body>
</html>
