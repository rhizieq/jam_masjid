<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jam Masjid Nurul Ilmi ITPLN</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Outfit:wght@400;600;800&family=Oswald:wght@400;500;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- GLOBAL THEME: MODERN MOSQUE CLOCK WITH GLASS --- */
        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #E0F6FF 25%, #B0E0E6 50%, #E0F6FF 75%, #87CEEB 100%);
            background-size: 400% 400%;
            animation: skyGradient 15s ease infinite;
            overflow: hidden;
            cursor: none;
            user-select: none;
            color: #1e293b;
            font-size: 1.2rem;
            position: relative;
        }

        @keyframes skyGradient {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* Glass Box Style - White Boxes */
        .glass-box {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-radius: 16px;
        }

        @supports not (backdrop-filter: blur(20px)) {
            .glass-box {
                background: rgba(255, 255, 255, 0.95);
            }
        }


        /* Analog Clock Glass */
        .analog-clock-glass {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(20px) saturate(150%);
            -webkit-backdrop-filter: blur(20px) saturate(150%);
            border: 3px solid rgba(255, 255, 255, 0.5);
            box-shadow:
                0 10px 40px rgba(0, 0, 0, 0.15),
                inset 0 2px 10px rgba(255, 255, 255, 0.6);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clock-face {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            position: relative;
        }

        .clock-number {
            position: absolute;
            font-size: 1.2rem;
            font-weight: 700;
            color: #1e293b;
            transform: translate(-50%, -50%);
        }

        .clock-hand {
            position: absolute;
            transform-origin: bottom center;
            border-radius: 4px;
            background: #1e293b;
        }

        .hour-hand {
            width: 5px;
            height: 60px;
            bottom: 50%;
            left: 50%;
            transform: translateX(-50%);
        }

        .minute-hand {
            width: 4px;
            height: 80px;
            bottom: 50%;
            left: 50%;
            transform: translateX(-50%);
        }

        .second-hand {
            width: 2px;
            height: 85px;
            bottom: 50%;
            left: 50%;
            transform: translateX(-50%);
            background: #fb923c;
        }

        .clock-center {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #1e293b;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        /* Digital Clock */
        .text-clock {
            color: #1e293b;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .font-clock {
            font-family: 'Oswald', sans-serif;
            letter-spacing: 3px;
        }

        .font-arab {
            font-family: 'Amiri', serif;
        }

        /* Header - Transparent */
        .header-bg {
            background: transparent;
        }

        /* Prayer Cards - Glass Design with Orange Highlight */
        .prayer-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            border-radius: 16px;
            padding: 0 35px;
            margin-bottom: 12px;
            height: 14%;
            transition: all 0.3s ease;
            position: relative;
        }

        .prayer-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .prayer-card.upcoming {
            background: rgba(251, 146, 60, 0.95);
            border: 3px solid #fb923c;
            box-shadow: 0 8px 24px rgba(251, 146, 60, 0.4);
            transform: scale(1.03);
        }

        .prayer-card.upcoming * {
            color: #ffffff !important;
        }

        .prayer-countdown {
            font-size: 1.4rem;
            font-weight: 600;
            color: #64748b;
            margin-top: 4px;
            display: none;
            /* Sembunyikan secara default */
        }

        .prayer-card.upcoming .prayer-countdown {
            display: block;
            /* Tampilkan hanya untuk jadwal yang di-highlight orange */
            color: #ffffff;
        }

        .prayer-card .prayer-name {
            color: #1e293b;
            font-weight: 700;
            letter-spacing: 1.5px;
            font-size: 1.8rem;
        }

        .prayer-card .prayer-time {
            color: #334155;
            font-weight: 800;
            font-size: 4rem;
        }

        .prayer-card.active .prayer-name {
            font-weight: 800;
            font-size: 2rem;
        }

        .prayer-card.active .prayer-time {
            font-weight: 900;
            font-size: 4.5rem;
        }

        .prayer-card i {
            color: #64748b;
            font-size: 2.5rem;
        }

        .prayer-card.active i {
            font-size: 2.8rem;
        }

        /* Icon Animations */
        .prayer-icon-sun {
            animation: rotateSun 8s linear infinite;
        }

        .prayer-icon-moon {
            animation: floatMoon 4s ease-in-out infinite;
        }

        @keyframes rotateSun {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        @keyframes floatMoon {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-8px) rotate(5deg);
            }
        }

        /* Slide Container */
        .slide-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.6);
            aspect-ratio: 16 / 9;
        }

        .slide-image {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }

        .slide-image.active {
            opacity: 1;
        }

        /* Footer */
        .footer-bg {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }

        .marquee-container {
            overflow: hidden;
            white-space: nowrap;
            position: relative;
        }

        .marquee-text {
            display: inline-block;
            padding-left: 100%;
            animation: marquee 50s linear infinite;
        }

        @keyframes marquee {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        /* Overlay - Glass dengan Tembus Pandang ke Jadwal */
        #overlay-screen {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: rgba(224, 242, 254, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #1e293b;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .overlay-active {
            display: flex !important;
        }

        .overlay-content-glass {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(20px) saturate(150%);
            -webkit-backdrop-filter: blur(20px) saturate(150%);
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 30px;
            padding: 80px 100px;
            box-shadow:
                0 25px 80px rgba(0, 0, 0, 0.2),
                inset 0 2px 10px rgba(255, 255, 255, 0.6);
            position: relative;
        }


        .progress-bar {
            width: 0%;
            height: 8px;
            background: linear-gradient(90deg, #fb923c 0%, #f97316 100%);
            border-radius: 4px;
            transition: width 1s linear;
        }

        #overlay-title {
            color: #1e293b;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        #overlay-title.khutbah-title {
            font-size: 12rem;
            margin-bottom: 2rem;
        }

        .khutbah-marquee-container {
            overflow: hidden;
            white-space: nowrap;
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin-top: 2rem;
        }

        .khutbah-marquee-text {
            display: inline-block;
            padding-left: 100%;
            animation: khutbah-marquee 30s linear infinite;
            font-size: 4rem;
            font-weight: 700;
            color: #dc2626;
            text-shadow: 0 4px 12px rgba(220, 38, 38, 0.5);
        }

        @keyframes khutbah-marquee {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        .blink {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            50% {
                opacity: 0.3;
            }
        }
    </style>
</head>

<body class="flex flex-col w-screen h-screen relative">

    <!-- OVERLAY (Adzan/Iqomah) -->
    <div id="overlay-screen">
        <div class="overlay-content-glass flex flex-col items-center justify-center relative">
            <img src="gambar/LOGO_IT_PLN_Kotak.png" class="w-48 h-auto mb-6 opacity-90 drop-shadow-lg"
                onerror="this.style.display='none'">

            <!-- Logo DKM, Al Futuwah, KMMNI -->
            <div class="flex items-center gap-6 mb-6">
                <div class="h-20 w-20 flex items-center justify-center" title="Masjid">
                    <img src="gambar/Logo_masjid.png" alt="Masjid" class="h-full w-auto object-contain"
                        onerror="this.style.display='none'">
                </div>
                <div class="h-20 w-20 flex items-center justify-center" title="Al Futuwah">
                    <img src="gambar/Logo_Al_Futuwah.png" alt="Al Futuwah" class="h-full w-auto object-contain"
                        onerror="this.style.display='none'">
                </div>
                <div class="h-20 w-20 flex items-center justify-center" title="KMMNI">
                    <img src="gambar/Logo_KMMNI.png" alt="KMMNI" class="h-full w-auto object-contain"
                        onerror="this.style.display='none'">
                </div>
            </div>

            <!-- Status untuk Adzan -->
            <div id="overlay-status"
                class="text-3xl font-light tracking-[0.4em] text-[#1e293b] mb-4 uppercase animate-pulse">MEMASUKI
                WAKTU</div>
            <h1 id="overlay-title" class="text-[10rem] font-bold font-clock mb-6 leading-none tracking-tighter">
                ADZAN
            </h1>
            <div id="overlay-subtitle" class="text-5xl text-[#64748b] mb-8 font-arab">Hayya 'alas Shalah</div>

            <!-- Container untuk Iqomah/Khutbah -->
            <div id="iqomah-counter-container" class="hidden w-full max-w-4xl flex-col items-center relative z-10">
                <div
                    class="w-full bg-white/40 h-6 rounded-full mb-8 overflow-hidden border-2 border-white/50 max-w-2xl mx-auto">
                    <div id="iqomah-progress" class="progress-bar"></div>
                </div>
                <div id="iqomah-timer"
                    class="text-[15rem] leading-none font-clock font-bold text-[#fb923c] drop-shadow-lg text-center">
                    10:00</div>
                <div id="iqomah-label" class="mt-6 text-3xl text-[#1e293b] tracking-[0.3em] uppercase font-bold hidden">
                    Menuju Iqomah</div>
            </div>

            <div id="khutbah-marquee" class="hidden khutbah-marquee-container relative z-10">
                <div class="khutbah-marquee-text">
                    Dilarang berbicara ketika imam sudah naik mimbar, mohon isi shaf terdepan terlebih dahulu • Dilarang
                    berbicara ketika imam sudah naik mimbar, mohon isi shaf terdepan terlebih dahulu • Dilarang
                    berbicara ketika imam sudah naik mimbar, mohon isi shaf terdepan terlebih dahulu
                </div>
            </div>

            <div id="overlay-message"
                class="hidden text-7xl font-bold mt-12 animate-bounce uppercase tracking-wide text-center px-4 text-[#1e293b] drop-shadow-lg relative z-10">
                Luruskan dan Rapatkan Shaf</div>
        </div>
    </div>

    <!-- HEADER (25%) -->
    <header class="h-[25%] w-full header-bg flex items-center justify-between px-10 z-30 relative">

        <!-- Kiri: Logo Container & Info dengan Glass Box -->
        <div class="flex items-start gap-6 h-full py-4 w-[60%] relative">
            <!-- Logo Utama ITPLN (Diperbesar setinggi 2 kotak, sejajar dengan 2 kotak) -->
            <div class="glass-box flex items-center justify-center p-4 group shrink-0" id="logo-itpln-box">
                <img src="gambar/LOGO_IT_PLN_Kotak.png" alt="ITPLN"
                    class="h-full w-auto object-contain filter drop-shadow-lg transform group-hover:scale-110 transition-transform duration-500"
                    onerror="this.style.display='none'; document.getElementById('fb-icon').classList.remove('hidden')">
                <i id="fb-icon" class="fas fa-mosque text-7xl text-[#64748b] hidden"></i>
            </div>

            <!-- Bagian Teks & Logo Kerjasama -->
            <div class="flex flex-col gap-2 h-full py-2 flex-grow relative" id="text-logo-container">
                <!-- Judul Masjid dengan Glass Box (Diperpendek) -->
                <div class="glass-box px-6 py-3 w-fit" id="masjid-box">
                    <h1 class="text-6xl font-extrabold text-[#1e293b] uppercase tracking-wide leading-none font-clock">
                        Masjid Nurul Ilmi</h1>
                    <span class="text-xl font-bold text-[#475569] tracking-[0.2em] uppercase mt-1">Institut
                        Teknologi PLN</span>
                </div>

                <!-- Baris Bawah: Logo Mitra dengan Glass Box (Sama panjang dengan kotak atas) -->
                <div class="flex items-center gap-5 glass-box px-5 py-3 w-fit" id="logo-box">
                    <div class="h-28 w-28 flex items-center justify-center" title="Masjid">
                        <img src="gambar/Logo_masjid.png" alt="Masjid" class="h-full w-auto object-contain"
                            onerror="this.style.display='none'">
                    </div>
                    <div class="h-28 w-28 flex items-center justify-center" title="Al Futuwah">
                        <img src="gambar/Logo_Al_Futuwah.png" alt="Al Futuwah" class="h-full w-auto object-contain"
                            onerror="this.style.display='none'">
                    </div>
                    <div class="h-28 w-28 flex items-center justify-center" title="KMMNI">
                        <img src="gambar/Logo_KMMNI.png" alt="KMMNI" class="h-full w-auto object-contain"
                            onerror="this.style.display='none'">
                    </div>
                </div>

            </div>
        </div>

        <!-- Kanan: Jam & Tanggal dengan Glass Box -->
        <div class="w-[40%] flex flex-col items-end justify-center h-full gap-4">
            <!-- Jam dengan Glass Box -->
            <div class="glass-box px-8 py-6 flex items-center gap-6 relative">
                <!-- Analog Clock Glass -->
                <div class="analog-clock-glass">
                    <div class="clock-face">
                        <div class="clock-number" style="top: 8%; left: 50%;">12</div>
                        <div class="clock-number" style="top: 50%; right: 8%;">3</div>
                        <div class="clock-number" style="bottom: 8%; left: 50%;">6</div>
                        <div class="clock-number" style="top: 50%; left: 8%;">9</div>
                        <div id="analog-hour-hand" class="clock-hand hour-hand"></div>
                        <div id="analog-minute-hand" class="clock-hand minute-hand"></div>
                        <div id="analog-second-hand" class="clock-hand second-hand"></div>
                        <div class="clock-center"></div>
                    </div>
                </div>

                <!-- Digital Clock -->
                <div class="flex items-center gap-2">
                    <span id="clock-hours"
                        class="text-[6rem] font-clock font-bold text-clock leading-none tracking-tighter">00</span>
                    <span class="text-[6rem] font-clock font-bold text-clock leading-none">:</span>
                    <span id="clock-minutes"
                        class="text-[6rem] font-clock font-bold text-clock leading-none tracking-tighter">00</span>
                    <span class="text-[6rem] font-clock font-bold text-clock leading-none">:</span>
                    <span id="clock-seconds"
                        class="text-[6rem] font-clock font-bold text-clock leading-none tracking-tighter">00</span>
                </div>
            </div>

            <!-- Tanggal dengan Glass Box -->
            <div class="glass-box px-6 py-3 flex items-center text-[#1e293b] font-semibold text-xl">
                <i class="far fa-calendar-alt mr-3 text-[#64748b]"></i>
                <span id="date-masehi" class="mr-5 tracking-wide">Loading...</span>
                <span class="text-[#94a3b8]">|</span>
                <span id="date-hijri" class="ml-5 font-arab text-[#1e293b] font-bold tracking-wide">Loading...</span>
            </div>
        </div>
    </header>

    <!-- CONTENT WRAPPER (67%) -->
    <div class="h-[67%] w-full flex p-10 gap-10 relative z-20">

        <!-- KOLOM KIRI: SLIDER (55%) -->
        <section class="w-[55%] h-full relative">
            <div class="slide-wrapper">
                <div id="slider-container" class="absolute inset-0 w-full h-full">
                    <!-- Images injected -->
                </div>

                <!-- Badge Info dengan Glass Box -->
                <div class="absolute top-8 left-8 glass-box px-6 py-3 flex items-center gap-4 z-10">
                    <span class="flex h-4 w-4 relative">
                        <span
                            class="animate-ping absolute inline-flex h-full w-full rounded-full bg-[#fb923c] opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-4 w-4 bg-[#fb923c]"></span>
                    </span>
                    <span class="font-bold tracking-wider text-lg text-[#1e293b]">INFORMASI UTAMA</span>
                </div>

            </div>
        </section>

        <!-- KOLOM KANAN: JADWAL SHALAT (45% - DIPERBESAR) -->
        <section class="w-[45%] h-full flex flex-col justify-between pt-1 relative" id="prayer-list-container">
            <div class="text-center text-[#64748b] animate-pulse mt-10 text-xl font-semibold">Memuat Jadwal...</div>
        </section>

    </div>

    <!-- FOOTER: RUNNING TEXT (8%) -->
    <footer class="h-[8%] w-full footer-bg flex items-center z-40 relative">
        <div
            class="h-full px-8 flex items-center justify-center text-[#1e293b] font-bold tracking-[0.2em] text-2xl gap-5 relative overflow-hidden shrink-0 border-r-2 border-white/30">
            <i class="fas fa-bullhorn transform -rotate-12 text-3xl text-[#64748b]"></i>
            <span>INFO</span>
        </div>

        <div class="flex-grow overflow-hidden relative h-full flex items-center">
            <div class="marquee-container w-full">
                <div class="marquee-text text-4xl font-medium text-[#1e293b] py-1 tracking-wide leading-normal">
                    Selamat Datang di Masjid Nurul Ilmi Institut Teknologi PLN. Mohon luruskan dan rapatkan shaf.
                    Nonaktifkan HP selama ibadah. Jagalah kebersihan area masjid.
                </div>
            </div>
        </div>
    </footer>

    <script>
        const CONFIG = { adzanTime: 1, iqomahTime: 10, jumatTime: 25, slideInterval: 8000 };
        const COORDINATES = { lat: '-6.1764', lng: '106.7236' };
        const CORRECTION = { 'Subuh': 0, 'Terbit': 0, 'Dzuhur': 0, 'Ashar': -2, 'Maghrib': 0, 'Isya': 0 };

        const SLIDE_IMAGES = [
            "gambar/kas.png",
            "gambar/donasi.png",
            "gambar/1.png",
            "gambar/2.png",
            "gambar/3.png",
            "gambar/4.png"
        ];

        const PRAYER_NAMES = ['Subuh', 'Terbit', 'Dzuhur', 'Ashar', 'Maghrib', 'Isya'];
        let prayerTimes = {};
        let isOverlayActive = false;
        let countdownInterval = null;
        let currentSlideIndex = 0;

        // Update Clock
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            document.getElementById('clock-hours').textContent = hours;
            document.getElementById('clock-minutes').textContent = minutes;
            document.getElementById('clock-seconds').textContent = seconds;

            // Analog clock
            const hourDeg = (now.getHours() % 12) * 30 + now.getMinutes() * 0.5;
            const minuteDeg = now.getMinutes() * 6;
            const secondDeg = now.getSeconds() * 6;

            document.getElementById('analog-hour-hand').style.transform = `translateX(-50%) rotate(${hourDeg}deg)`;
            document.getElementById('analog-minute-hand').style.transform = `translateX(-50%) rotate(${minuteDeg}deg)`;
            document.getElementById('analog-second-hand').style.transform = `translateX(-50%) rotate(${secondDeg}deg)`;
        }

        setInterval(updateClock, 1000);
        updateClock();

        // Update Date
        function updateDate() {
            const now = new Date();
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            const dayName = days[now.getDay()];
            const date = now.getDate();
            const month = months[now.getMonth()];
            const year = now.getFullYear();

            document.getElementById('date-masehi').textContent = `${dayName}, ${date} ${month} ${year}`;

            // Hijri date menggunakan Intl.DateTimeFormat untuk akurasi
            try {
                const formatter = new Intl.DateTimeFormat('id-ID-u-ca-islamic', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
                const hijriDate = formatter.format(now);
                document.getElementById('date-hijri').textContent = hijriDate + ' H';
            } catch (e) {
                // Fallback jika browser tidak support
                const hijriYear = Math.floor((year - 622) * 0.97);
                const hijriMonth = ['Muharram', 'Safar', 'Rabi\' al-Awwal', 'Rabi\' al-Thani', 'Jumada al-Ula', 'Jumada al-Thani', 'Rajab', 'Sha\'ban', 'Ramadan', 'Shawwal', 'Dhu al-Qi\'dah', 'Dhu al-Hijjah'];
                const hijriDate = Math.floor((now - new Date(year, 0, 1)) / (1000 * 60 * 60 * 24)) % 30;
                const hijriMonthIndex = Math.floor((now - new Date(year, 0, 1)) / (1000 * 60 * 60 * 24) / 30) % 12;
                document.getElementById('date-hijri').textContent = `${hijriDate} ${hijriMonth[hijriMonthIndex]} ${hijriYear} H`;
            }
        }

        updateDate();
        setInterval(updateDate, 60000);

        // Fetch Prayer Times
        async function fetchPrayerTimes() {
            try {
                const response = await fetch(
                    `https://api.aladhan.com/v1/timings/${Math.floor(Date.now() / 1000)}?latitude=${COORDINATES.lat}&longitude=${COORDINATES.lng}&method=2`
                );
                const data = await response.json();
                const timings = data.data.timings;

                prayerTimes = {
                    'Subuh': formatTime(timings.Fajr),
                    'Terbit': formatTime(timings.Sunrise),
                    'Dzuhur': formatTime(timings.Dhuhr),
                    'Ashar': formatTime(timings.Asr),
                    'Maghrib': formatTime(timings.Maghrib),
                    'Isya': formatTime(timings.Isha)
                };

                // Apply corrections
                Object.keys(CORRECTION).forEach(key => {
                    if (prayerTimes[key]) {
                        const [h, m] = prayerTimes[key].split(':');
                        const date = new Date();
                        date.setHours(parseInt(h), parseInt(m) + CORRECTION[key], 0);
                        prayerTimes[key] = formatTime(date);
                    }
                });

                renderPrayerList();
                checkPrayerTime();
            } catch (error) {
                console.error('Error fetching prayer times:', error);
            }
        }

        function formatTime(time) {
            if (typeof time === 'string') {
                const [h, m] = time.split(':');
                return `${h}:${m}`;
            }
            const h = String(time.getHours()).padStart(2, '0');
            const m = String(time.getMinutes()).padStart(2, '0');
            return `${h}:${m}`;
        }

        function renderPrayerList() {
            const container = document.getElementById('prayer-list-container');
            container.innerHTML = '';
            PRAYER_NAMES.forEach((name, index) => {
                const time = prayerTimes[name];
                let icon = 'fa-moon';
                if (name === 'Terbit' || name === 'Dzuhur' || name === 'Ashar') icon = 'fa-sun';

                const card = document.createElement('div');
                card.id = `card-${name}`;
                card.className = 'prayer-card';

                const iconClass = icon === 'fa-sun' ? 'prayer-icon-sun' : 'prayer-icon-moon';
                card.innerHTML = `
                    <div class="flex items-center gap-8">
                        <div class="w-16 flex justify-center"><i class="fas ${icon} ${iconClass}"></i></div>
                        <div class="flex flex-col">
                            <span class="prayer-name">${name}</span>
                            <span class="prayer-countdown" id="countdown-${name}">-</span>
                        </div>
                    </div>
                    <div class="prayer-time leading-none pt-1">${time}</div>
                `;
                container.appendChild(card);
            });
            updateCountdowns();
        }

        function checkPrayerTime() {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();

            // Cari shalat TERDEKAT yang akan datang (untuk highlight orange)
            let nearestPrayerMinutes = Infinity;
            let nearestPrayerName = null;

            PRAYER_NAMES.forEach((name) => {
                const [h, m] = prayerTimes[name].split(':');
                let prayerMinutes = parseInt(h) * 60 + parseInt(m);

                // Jika shalat sudah terlewat hari ini, berarti besok
                if (prayerMinutes <= currentTime) {
                    prayerMinutes += 24 * 60;
                }

                // Cari yang paling dekat
                if (prayerMinutes < nearestPrayerMinutes) {
                    nearestPrayerMinutes = prayerMinutes;
                    nearestPrayerName = name;
                }
            });

            // Update semua card
            PRAYER_NAMES.forEach((name) => {
                const card = document.getElementById(`card-${name}`);
                if (!card) return;

                // Hapus semua kelas active/upcoming
                card.classList.remove('active', 'upcoming');

                // Highlight shalat TERDEKAT yang akan datang dengan warna orange
                if (name === nearestPrayerName) {
                    card.classList.add('upcoming');
                }
            });

            updateCountdowns();
        }

        function updateCountdowns() {
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            const currentSeconds = now.getSeconds();

            // Cari shalat TERDEKAT yang akan datang (bukan yang sedang tersekat)
            let nearestPrayerMinutes = Infinity;
            let nearestPrayerName = null;

            PRAYER_NAMES.forEach((name) => {
                const [h, m] = prayerTimes[name].split(':');
                let prayerMinutes = parseInt(h) * 60 + parseInt(m);

                // Jika shalat sudah terlewat hari ini, berarti besok
                if (prayerMinutes <= currentMinutes) {
                    prayerMinutes += 24 * 60;
                }

                // Cari yang paling dekat
                if (prayerMinutes < nearestPrayerMinutes) {
                    nearestPrayerMinutes = prayerMinutes;
                    nearestPrayerName = name;
                }
            });

            // Update countdown untuk semua shalat, semua menuju shalat terdekat
            PRAYER_NAMES.forEach((name) => {
                const countdownEl = document.getElementById(`countdown-${name}`);
                if (!countdownEl) return;

                // Semua countdown menuju shalat terdekat
                const diffMinutes = nearestPrayerMinutes - currentMinutes;
                const totalSeconds = diffMinutes * 60 - currentSeconds;
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;

                countdownEl.textContent = `-${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            });
        }

        setInterval(checkPrayerTime, 1000); // Update setiap detik untuk countdown
        setInterval(updateCountdowns, 1000); // Update countdown setiap detik
        fetchPrayerTimes();

        // Samakan lebar kotak logo dengan kotak masjid dan tinggi logo ITPLN dengan 2 kotak
        function syncBoxWidths() {
            const masjidBox = document.getElementById('masjid-box');
            const logoBox = document.getElementById('logo-box');
            const logoItplnBox = document.getElementById('logo-itpln-box');

            if (masjidBox && logoBox) {
                // Samakan lebar kotak logo dengan kotak masjid
                logoBox.style.width = masjidBox.offsetWidth + 'px';
            }

            if (masjidBox && logoBox && logoItplnBox) {
                // Hitung tinggi gabungan kotak masjid dan kotak logo
                const masjidHeight = masjidBox.offsetHeight;
                const logoHeight = logoBox.offsetHeight;
                const gap = 8; // gap-2 = 8px
                const totalHeight = masjidHeight + logoHeight + gap;

                // Set tinggi dan lebar logo ITPLN sama dengan tinggi gabungan
                logoItplnBox.style.height = totalHeight + 'px';
                logoItplnBox.style.width = totalHeight + 'px'; // Buat persegi

                // Sejajarkan logo ITPLN dengan bagian atas kotak masjid
                logoItplnBox.style.alignSelf = 'flex-start';
            }
        }
        window.addEventListener('load', syncBoxWidths);
        window.addEventListener('resize', syncBoxWidths);
        // Panggil juga setelah render
        setTimeout(syncBoxWidths, 100);

        // Slideshow
        function initSlideshow() {
            const container = document.getElementById('slider-container');
            SLIDE_IMAGES.forEach((src, index) => {
                const img = document.createElement('img');
                img.src = src;
                img.className = `slide-image ${index === 0 ? 'active' : ''}`;
                img.onerror = function () { this.style.display = 'none'; };
                container.appendChild(img);
            });

            setInterval(() => {
                const images = container.querySelectorAll('.slide-image');
                images[currentSlideIndex].classList.remove('active');
                currentSlideIndex = (currentSlideIndex + 1) % images.length;
                images[currentSlideIndex].classList.add('active');
            }, CONFIG.slideInterval);
        }

        initSlideshow();

        // Overlay Functions
        function startAdzan(name, day) {
            isOverlayActive = true;
            document.getElementById('overlay-screen').classList.add('overlay-active');

            // Tampilkan elemen adzan
            document.getElementById('overlay-status').textContent = 'MEMASUKI WAKTU';
            document.getElementById('overlay-status').classList.remove('hidden');
            document.getElementById('overlay-title').textContent = `ADZAN ${name.toUpperCase()}`;
            document.getElementById('overlay-title').classList.remove('hidden');
            document.getElementById('overlay-subtitle').textContent = 'Hayya \'alas Shalah';
            document.getElementById('overlay-subtitle').classList.remove('hidden');

            // Sembunyikan container iqomah
            document.getElementById('iqomah-counter-container').classList.add('hidden');
            document.getElementById('overlay-message').classList.add('hidden');
            document.getElementById('khutbah-marquee').classList.add('hidden');

            setTimeout(() => {
                startIqomah(name, day);
            }, CONFIG.adzanTime * 60000);
        }

        function startIqomah(name, day) {
            const isJumat = (day === 5 && name === 'Dzuhur');

            // Sembunyikan elemen adzan
            document.getElementById('overlay-status').classList.add('hidden');
            document.getElementById('overlay-title').classList.add('hidden');
            document.getElementById('overlay-subtitle').classList.add('hidden');

            // Tampilkan container iqomah
            const container = document.getElementById('iqomah-counter-container');
            container.classList.remove('hidden');
            const labelEl = document.getElementById('iqomah-label');

            if (isJumat) {
                // Untuk Khutbah Jumat: tampilkan title besar di tengah, sembunyikan label kecil
                document.getElementById('overlay-title').textContent = "KHUTBAH JUMAT";
                document.getElementById('overlay-title').classList.remove('hidden');
                document.getElementById('overlay-title').classList.add('khutbah-title');
                labelEl.classList.add('hidden'); // Sembunyikan label kecil
                document.getElementById('khutbah-marquee').classList.remove('hidden');
            } else {
                // Untuk Iqomah biasa
                document.getElementById('overlay-title').classList.add('hidden');
                document.getElementById('overlay-title').classList.remove('khutbah-title');
                labelEl.innerText = "MENUNGGU IQOMAH";
                labelEl.classList.remove('hidden', 'text-5xl'); // Tampilkan label untuk iqomah
                document.getElementById('khutbah-marquee').classList.add('hidden');
            }

            const totalSeconds = (isJumat ? CONFIG.jumatTime : CONFIG.iqomahTime) * 60;
            let remaining = totalSeconds;

            function updateCountdown() {
                const minutes = Math.floor(remaining / 60);
                const seconds = remaining % 60;
                document.getElementById('iqomah-timer').textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                const progress = ((totalSeconds - remaining) / totalSeconds) * 100;
                document.getElementById('iqomah-progress').style.width = `${progress}%`;

                if (remaining <= 0) {
                    clearInterval(countdownInterval);
                    showShalatAlert();
                    return;
                }
                remaining--;
            }

            updateCountdown();
            if (countdownInterval) clearInterval(countdownInterval);
            countdownInterval = setInterval(updateCountdown, 1000);
        }

        function showShalatAlert() {
            // Sembunyikan semua elemen
            document.getElementById('overlay-status').classList.add('hidden');
            document.getElementById('overlay-title').classList.add('hidden');
            document.getElementById('overlay-subtitle').classList.add('hidden');
            document.getElementById('iqomah-counter-container').classList.add('hidden');
            document.getElementById('khutbah-marquee').classList.add('hidden');

            // Tampilkan pesan shalat
            document.getElementById('overlay-message').classList.remove('hidden');

            setTimeout(() => {
                closeOverlay();
            }, 30000);
        }

        function closeOverlay() {
            isOverlayActive = false;
            document.getElementById('overlay-screen').classList.remove('overlay-active');
            document.getElementById('khutbah-marquee').classList.add('hidden');
            if (countdownInterval) clearInterval(countdownInterval);
        }

        // Test Functions
        function testAdzan() {
            console.log("TEST MODE: Triggering Adzan (1 minute)");
            startAdzan('Dzuhur', 1);
        }

        function testIqomah() {
            console.log("TEST MODE: Triggering Iqomah (10 minutes)");
            startIqomah('Dzuhur', 1);
        }

        function testKhutbahJumat() {
            console.log("TEST MODE: Triggering Khutbah Jumat (25 minutes with running text)");
            startIqomah('Dzuhur', 5);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function (e) {
            if (e.keyCode === 10009) {
                try {
                    tizen.application.getCurrentApplication().exit();
                } catch (err) {
                    window.history.back();
                }
            }
            if (e.key === '1') testAdzan();
            if (e.key === '2') testIqomah();
            if (e.key === '3') testKhutbahJumat();
            if (e.key === '0' || e.key === 'Escape') closeOverlay();
        });

        // Auto-check prayer times
        setInterval(() => {
            const now = new Date();
            const currentTime = formatTime(now);

            PRAYER_NAMES.forEach((name, index) => {
                if (prayerTimes[name] === currentTime) {
                    const day = now.getDay();
                    startAdzan(name, day);
                }
            });
        }, 60000);
    </script>
</body>

</html>